# 编译问题及其解决方案
## selected processor does not support xxx
```txt
    /tmp/ccYR3bl9.s:27: Error: selected processor does not support requested special purpose register -- `mrs r3,psp'
    /tmp/ccYR3bl9.s:51: Error: selected processor does not support requested special purpose register -- `msr psp,r3'
    /tmp/ccYR3bl9.s:71: Error: selected processor does not support requested special purpose register -- `mrs r3,msp'
    /tmp/ccYR3bl9.s:95: Error: selected processor does not support requested special purpose register -- `msr msp,r3'
    /tmp/ccYR3bl9.s:120: Error: selected processor does not support requested special purpose register -- `mrs r3,basepri_max'
    /tmp/ccYR3bl9.s:149: Error: selected processor does not support requested special purpose register -- `msr basepri,r3'
    /tmp/ccYR3bl9.s:176: Error: selected processor does not support requested special purpose register -- `mrs r3,primask'
    /tmp/ccYR3bl9.s:205: Error: selected processor does not support requested special purpose register -- `msr primask,r3'
    /tmp/ccYR3bl9.s:232: Error: selected processor does not support requested special purpose register -- `mrs r3,faultmask'
    /tmp/ccYR3bl9.s:261: Error: selected processor does not support requested special purpose register -- `msr faultmask,r3'
    /tmp/ccYR3bl9.s:288: Error: selected processor does not support requested special purpose register -- `mrs r3,control'
    /tmp/ccYR3bl9.s:317: Error: selected processor does not support requested special purpose register -- `msr control,r3'
    /tmp/ccYR3bl9.s:346: Error: selected processor does not support `rev r3,r3' in ARM mode
    /tmp/ccYR3bl9.s:378: Error: selected processor does not support `rev16 r3,r3' in ARM mode
    /tmp/ccYR3bl9.s:410: Error: selected processor does not support `revsh r3,r3' in ARM mode
    /tmp/ccYR3bl9.s:441: Error: selected processor does not support `rbit r3,r3' in ARM mode
    /tmp/ccYR3bl9.s:472: Error: selected processor does not support `ldrexb r3,[r3]' in ARM mode
    /tmp/ccYR3bl9.s:503: Error: selected processor does not support `ldrexh r3,[r3]' in ARM mode
    /tmp/ccYR3bl9.s:534: Error: selected processor does not support `ldrex r3,[r3]' in ARM mode
    /tmp/ccYR3bl9.s:568: Error: selected processor does not support `strexb r3,r1,[r2]' in ARM mode
    /tmp/ccYR3bl9.s:602: Error: selected processor does not support `strexh r3,r1,[r2]' in ARM mode
    /tmp/ccYR3bl9.s:635: Error: selected processor does not support `strex r3,r2,[r3]' in ARM mode
    make[2]: *** [CMakeFiles/main.dir/build.make:79: CMakeFiles/main.dir/libs/device_libs/core_cm3.c.o] Error 1

    # 解决方案: 修改CMakeLists.txt,设置编译选项(000.STM32/000.STM32F103C8T6/000.STM32F103C8T6_1/000.STM32F103C8T6_1/CMakeLists.txt)
    # CMAKE_C_FLAGS 设置C编译选项;CMAKE_CXX_FLAGS 设置C++编译选项
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} --specs=nosys.specs -mcpu=cortex-m3 -march=armv7-m")
    #ASMFLAGS
    set ( CMAKE_ASM_FLAGS "-x assembler-with-cpp ${CMAKE_C_FLAGS}")

```

## Error: registers may not be the same -- `strexh r0,r0,[r1]'
```txt
   /tmp/ccGEjTjd.s:583: Error: registers may not be the same -- `strexb r3,r2,[r3]'
   /tmp/ccGEjTjd.s:618: Error: registers may not be the same -- `strexh r3,r2,[r3]'

   # 解决方案: 000.STM32/999.开发问题收集/001.references/[Bug gas_13215] New_ ARM Cortex M3 strexh strexb instructions with same registers generates error.pdf
     修改 core_cm3.c 
     uint32_t __STREXB(uint8_t value, uint8_t *addr)
     {
        uint32_t result=0;
       
        __ASM volatile ("strexb %0, %2, [%1]" : "=r" (result) : "r" (addr), "r" (value) );
        // 修改为: __ASM volatile ("strexb %0, %2, [%1]" : "=&r" (result) : "r" (addr), "r" (value) );
        return(result);
     }
     
     /**
      * @brief  STR Exclusive (16 bit)
      *
      * @param  value  value to store
      * @param  *addr  address pointer
      * @return        successful / failed
      *
      * Exclusive STR command for 16 bit values
      */
     uint32_t __STREXH(uint16_t value, uint16_t *addr)
     {
        uint32_t result=0;
       
        __ASM volatile ("strexh %0, %2, [%1]" : "=r" (result) : "r" (addr), "r" (value) );
        // 修改为: __ASM volatile ("strexh %0, %2, [%1]" : "=&r" (result) : "r" (addr), "r" (value) );
        return(result);
     }
```